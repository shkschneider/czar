/*
 * Test defer functionality
 * Tests: defer keyword with cleanup attribute
 */

#include <stdlib.h>
#include <stdio.h>

/* User-provided cleanup function for free */
void cleanup_free(void **ptr) {
    if (ptr && *ptr) {
        printf("Cleaning up: %p\n", *ptr);
        free(*ptr);
        *ptr = NULL;
    }
}

int main(void) {
    /* Test 1: Simple defer with malloc/free */
    void *p = malloc(100);
    defer cleanup_free(p);
    printf("Allocated: %p\n", p);
    printf("After defer\n");
    
    return 0;
}
