#include <stdint.h>
#include <stdio.h>

/*
 * Test automatic typedef generation for structs
 * CZar should automatically generate typedef for named structs
 * so that we can use MyStruct instead of struct MyStruct
 */

/* Define a struct - should auto-generate typedef */
struct Point {
    i32 x;
    i32 y;
};

/* Define another struct */
struct Color {
    u8 r;
    u8 g;
    u8 b;
};

/* Function using the typedef name (without struct keyword) */
void set_point(mut Point* p, i32 x, i16 y) {
    p.x = x;
    p.y = y;
}

/* Function returning the typedef name */
Point create_point(i32 x, i32 y) {
    Point point = {0};
    point.x = x;
    point.y = y;
    return point;
}

/* Function using Color typedef */
void print_color(Color c) {
    printf("Color: (%u, %u, %u)\n", c.r, c.g, c.b);
}

int main(void) {
    /* Test 1: Use Point typedef instead of struct Point */
    Point pt = {0};
    set_point(&pt, 10, 20);
    cz_assert(pt.x == 10);
    cz_assert(pt.y == 20);
    printf("Test 1 passed: Can use Point instead of struct Point\n");

    /* Test 2: Create point using function */
    Point pt2 = create_point(30, 40);
    cz_assert(pt2.x == 30);
    cz_assert(pt2.y == 40);
    printf("Test 2 passed: Can return Point from function\n");

    /* Test 3: Use Color typedef */
    Color red = {0};
    red.r = 255;
    red.g = 0;
    red.b = 0;
    print_color(red);
    printf("Test 3 passed: Can use Color typedef\n");

    printf("All struct typedef tests passed!\n");
    return 0;
}
