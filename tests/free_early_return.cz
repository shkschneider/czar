// Test automatic cleanup with early return

struct Data {
    i32 value
}

fn test_early(i32 x) i32 {
    Data* d1 = new Data { value: 10 }
    Data* d2 = new Data { value: 20 }

    if x > 5 {
        // Early return - should free d1 and d2 before returning
        return d1.value + d2.value
    }

    // Normal return - should also free d1 and d2
    return d1.value
}

fn main() i32 {
    i32 r1 = test_early(10)  // Takes early return path: 30
    i32 r2 = test_early(3)   // Takes normal return path: 10
    return r1 + r2 - 40
}
// Expected: 30 + 10 = 40
