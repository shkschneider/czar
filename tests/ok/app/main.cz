// Comprehensive modularization test demonstrating all module features
// This is a single-file test showing module syntax that will work with
// future multi-file compilation support.

#module app

// These imports demonstrate the syntax but won't resolve in single-file mode
// import app.math
// import app.geometry as geo
// import app.utils
#import app.geometry

// Demonstrate unused import warning
#import app.unused

// This calls get_width which is defined later
fn calculate_area(Rectangle rect) i32 {
    return get_width(rect) * rect.height
}

fn calculate_perimeter(Rectangle rect) i32 {
    return 2 * (rect.width + rect.height)
}

// Main function demonstrating usage - calls functions that are defined later
fn main() i32 {
    // Test math operations
    i32 sum = add(10, 20)                         // 30
    i32 product = multiply(5, 6)                  // 30
    i32 squares = sum_of_squares(3, 4)           // 25

    // Test geometry
    Point p1 = create_point(0, 0)
    Point p2 = create_point(10, 5)

    Rectangle rect = Rectangle {
        top_left: p1,
        width: 10,
        height: 5
    }

    i32 area = calculate_area(rect)              // 50
    i32 perimeter = calculate_perimeter(rect)    // 30

    // Test utils
    i32 abs_val = abs(-15)                       // 15
    i32 max_val = max(area, perimeter)           // 50
    i32 min_val = min(area, perimeter)           // 30
    i32 clamped = clamp(150)                     // 100

    // Calculate: 30 + 30 + 25 - 50 - 30 + 15 - 50 + 30 - 100 + 100 = 0
    i32 result = sum + product + squares - area - perimeter + abs_val - max_val + min_val - clamped + 100

    return result
}

// Private helper functions defined after use - this works now with forward declarations!

fn internal_square(i32 x) i32 {
    return x * x
}

fn get_width(Rectangle rect) i32 {
    return rect.width
}

fn clamp_value(i32 x, i32 min_val, i32 max_val) i32 {
    if x < min_val {
        return min_val
    }
    if x > max_val {
        return max_val
    }
    return x
}
