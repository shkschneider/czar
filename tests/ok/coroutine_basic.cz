// Test basic coroutine functionality
#module ok
#import cz.co.*
#import cz.fmt.*

fn main() i32 {
    // Create coroutines with inline #unsafe blocks to set up functions
    Coroutine? co1 = new Coroutine {}
    Coroutine? co2 = new Coroutine {}
    
    #unsafe {
        // Define counter function inline in C
        void counter1() {
            for (uint8_t c = 1; c <= 10; c++) {
                _cz_co_yield((int32_t)c);
            }
        }
        
        void counter2() {
            for (uint8_t c = 1; c <= 10; c++) {
                _cz_co_yield((int32_t)c);
            }
        }
        
        // Initialize coroutines with these functions
        co1->handle = _cz_co_init(counter1);
        co2->handle = _cz_co_init(counter2);
    }
    
    printf("coroutines launched\n")
    
    // Resume each coroutine a few times
    mut i32 val1 = co1:resume()
    mut i32 val2 = co2:resume()
    
    printf("co1: %d, co2: %d\n", val1, val2)
    
    val1 = co1:resume()
    val2 = co2:resume()
    
    printf("co1: %d, co2: %d\n", val1, val2)
    
    // Free coroutines (destructor will be called automatically)
    free co1
    free co2
    
    return 0
}
