// Test pairs with heap allocation and pointers

fn create_pair(i32 a, i32 b) pair<i32:i32>? {
    return new pair [ a: b ]
}

fn sum_pair(pair<i32:i32>? p) i32 {
    return p.left + p.right
}

fn main() i32 {
    // Test heap-allocated pair
    pair<i32:i32>? p1 = new pair [ 15: 25 ]
    #defer free p1
    
    if p1.left != 15 {
        return 1
    }
    
    if p1.right != 25 {
        return 2
    }
    
    // Test pair creation function
    pair<i32:i32>? p2 = create_pair(30, 40)
    #defer free p2
    
    if p2.left != 30 or p2.right != 40 {
        return 3
    }
    
    // Test pair sum function
    i32 total = sum_pair(p2)
    if total != 70 {
        return 4
    }
    
    // Test multiple heap pairs
    pair<i32:i32>? p3 = new pair [ 100: 200 ]
    #defer free p3
    
    i32 sum = sum_pair(p1) + sum_pair(p2) + sum_pair(p3)
    // 40 + 70 + 300 = 410
    if sum != 410 {
        return 5
    }
    
    return 0
}
