// Demonstrates safe pointer casting and address-of operator
// Shows how to explicitly work with pointers

struct Vec2 {
    i32 x
    i32 y
}

struct Vec3 {
    i32 x
    i32 y
    i32 z
}

fn print_vec2(Vec2* v) void {
    if (v != null) {
        println("Vec2: (", v.x, ", ", v.y, ")")
    }
}

fn main() i32 {
    // Stack-allocated structs
    Vec2 v2 = Vec2{x: 10, y: 20}
    Vec3 v3 = Vec3{x: 1, y: 2, z: 3}
    
    // Must use explicit address-of operator to get pointer
    Vec2* ptr2 = &v2
    Vec3* ptr3 = &v3
    
    // Can pass address directly to function
    print_vec2(&v2)
    
    // Heap allocation returns pointer automatically
    Vec2* heap_v2 = new Vec2{x: 100, y: 200}
    print_vec2(heap_v2)
    
    // Pointer to u64 for address printing (requires unsafe cast !!)
    u64 addr = <u64> ptr2 !!
    println("Address: ", addr)
    
    // Free heap-allocated memory
    free(heap_v2)
    
    return 0
}
