// Test UTF-8 string support
// The czar_string type treats strings as byte arrays, which naturally supports UTF-8
#import cz

fn main() i32 {
    // Test UTF-8 strings with multi-byte characters
    // "Hello" = 5 ASCII chars = 5 bytes
    // "疸뒪뎳" = 2 Chinese chars = 6 bytes (3 bytes each in UTF-8)
    // "游때" = 1 emoji (U+1F601 - grinning face with smiling eyes) = 4 bytes in UTF-8
    
    cz.print("=== Basic UTF-8 Tests ===")
    
    // Test 1: Simple UTF-8 string with Chinese characters
    string s1 = string "Hello 疸뒪뎳"
    
    // The length should be in bytes, not characters
    // "Hello " = 6 bytes, "疸뒪뎳" = 6 bytes, total = 12 bytes
    if s1.length != 12 {
        cz.print("ERROR: Expected length 12 bytes")
        return 1
    }
    cz.print(s1.cstr())
    cz.print("Test 1 PASS: Chinese chars")
    
    // Test 2: Find UTF-8 substring
    string needle = string "疸뒪뎳"
    i32 idx = s1.index(needle)
    // "Hello " = 6 bytes, so "疸뒪뎳" starts at byte offset 6
    if idx != 6 {
        cz.print("ERROR: Expected index 6 (byte offset)")
        return 2
    }
    cz.print("Test 2 PASS: Find UTF-8 substring")
    
    // Test 3: Contains UTF-8
    i32 contains = s1.contains(needle)
    if contains != 1 {
        cz.print("ERROR: Should contain UTF-8 substring")
        return 3
    }
    cz.print("Test 3 PASS: Contains UTF-8")
    
    // EXTENSIVE TESTING with 4-byte emoji '游때' (U+1F601)
    cz.print("=== Testing 4-byte emoji 游때 ===")
    
    // Test 4: Create string with 游때
    string smiley = string "游때"
    if smiley.length != 4 {
        cz.print("ERROR: Emoji 游때 should be 4 bytes")
        return 4
    }
    cz.print(smiley.cstr())
    cz.print("Test 4 PASS: 游때 is 4 bytes")
    
    // Test 5: String with 游때 in middle
    string with_smiley = string "Hi 游때 there"
    // "Hi " = 3 bytes, "游때" = 4 bytes, " there" = 6 bytes = 13 bytes total
    if with_smiley.length != 13 {
        cz.print("ERROR: 'Hi 游때 there' should be 13 bytes")
        return 5
    }
    cz.print(with_smiley.cstr())
    cz.print("Test 5 PASS: String with 游때")
    
    // Test 6: Multiple 游때 emojis
    string multi = string "游때游때游때"
    // 3 emojis * 4 bytes = 12 bytes
    if multi.length != 12 {
        cz.print("ERROR: Three 游때 should be 12 bytes")
        return 6
    }
    cz.print(multi.cstr())
    cz.print("Test 6 PASS: Multiple 游때")
    
    // Test 7: Find 游때 in string
    string haystack = string "Hello 游때 World"
    // "Hello " = 6 bytes, so 游때 starts at byte offset 6 (counting from 0)
    i32 emoji_idx = haystack.index(smiley)
    if emoji_idx != 6 {
        cz.print("ERROR: 游때 should be at byte offset 6")
        return 7
    }
    cz.print("Test 7 PASS: Found 游때 at correct byte offset")
    
    // Test 8: Contains 游때
    if haystack.contains(smiley) != 1 {
        cz.print("ERROR: String should contain 游때")
        return 8
    }
    cz.print("Test 8 PASS: Contains 游때")
    
    // Test 9: Mix ASCII and 游때
    string mixed = string "ABC游때DEF"
    // "ABC" = 3 bytes, "游때" = 4 bytes, "DEF" = 3 bytes = 10 bytes
    if mixed.length != 10 {
        cz.print("ERROR: 'ABC游때DEF' should be 10 bytes")
        return 9
    }
    cz.print(mixed.cstr())
    cz.print("Test 9 PASS: Mixed ASCII and 游때")
    
    // Test 10: Prefix with 游때
    string prefix_smiley = string "游때Hello"
    if prefix_smiley.prefix(smiley) != 1 {
        cz.print("ERROR: String should start with 游때")
        return 10
    }
    cz.print("Test 10 PASS: Prefix with 游때")
    
    // Test 11: Suffix with 游때
    string suffix_smiley = string "Hello游때"
    if suffix_smiley.suffix(smiley) != 1 {
        cz.print("ERROR: String should end with 游때")
        return 11
    }
    cz.print("Test 11 PASS: Suffix with 游때")
    
    // Test 12: Multiple different UTF-8 characters
    string utf8_mix = string "Hello 疸뒪뎳 游때"
    // "Hello " = 6, "疸뒪뎳" = 6, " " = 1, "游때" = 4 = 17 bytes
    if utf8_mix.length != 17 {
        cz.print("ERROR: Mixed UTF-8 should be 17 bytes")
        return 12
    }
    cz.print(utf8_mix.cstr())
    cz.print("Test 12 PASS: Mixed UTF-8 characters")
    
    // Test 13: Find Chinese in mixed string
    if utf8_mix.index(needle) != 6 {
        cz.print("ERROR: Chinese chars should be at offset 6")
        return 13
    }
    cz.print("Test 13 PASS: Find Chinese in mixed string")
    
    // Test 14: Find emoji in mixed string
    // "Hello 疸뒪뎳 " = 6 + 6 + 1 = 13 bytes
    if utf8_mix.index(smiley) != 13 {
        cz.print("ERROR: Emoji should be at offset 13")
        return 14
    }
    cz.print("Test 14 PASS: Find emoji in mixed string")
    
    cz.print("=== All UTF-8 tests PASSED ===")
    
    return 0
}

